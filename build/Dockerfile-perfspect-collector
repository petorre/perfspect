# Copyright (C) 2025 Intel Corporation
# SPDX-License-Identifier: Apache-2.0

ARG hosttype

FROM ubuntu:24.04 AS base
RUN apt-get update -y && \
    apt-get upgrade -y && \
    apt-get install -y curl jq net-tools psmisc wget

FROM base AS ver-x86_64
WORKDIR /tmp
RUN wget -qO- https://github.com/intel/PerfSpect/releases/latest/download/perfspect.tgz | tar xvz && \
    cp perfspect/perfspect /usr/local/bin/perfspect

FROM base AS ver-aarch64
# perfspect-aarch64 from https://github.com/intel/PerfSpect/actions/runs/17079126561
COPY image-collector-aarch64 /

FROM ver-${hosttype} AS final
COPY image-collector /
ENTRYPOINT ["/entrypoint.sh"]
EXPOSE 11434/tcp
HEALTHCHECK NONE

